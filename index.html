<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Fishing Game</title>
<style>
body { margin:0; overflow:hidden; }
#message {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  color:white;
  font-size:24px;
  text-align:center;
  display:none;
  text-shadow:2px 2px 5px black;
}
</style>
</head>
<body>
<div id="message">Message</div>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/PointerLockControls.js"></script>
<script>
// ====== Scene setup ======
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);

let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Lighting
scene.add(new THREE.AmbientLight(0x404040));
let dirLight = new THREE.DirectionalLight(0xffffff,1);
dirLight.position.set(10,20,10);
scene.add(dirLight);

// ====== Player setup ======
let player = new THREE.Object3D();
player.add(camera);
scene.add(player);
camera.position.set(0,2,0);

let controls = new THREE.PointerLockControls(camera, document.body);
document.body.addEventListener('click',()=>{ controls.lock(); });

// Movement
let moveForward=false, moveBackward=false, moveLeft=false, moveRight=false;
document.addEventListener('keydown', e => {
  if(e.key==='w') moveForward=true;
  if(e.key==='s') moveBackward=true;
  if(e.key==='a') moveLeft=true;
  if(e.key==='d') moveRight=true;
});
document.addEventListener('keyup', e => {
  if(e.key==='w') moveForward=false;
  if(e.key==='s') moveBackward=false;
  if(e.key==='a') moveLeft=false;
  if(e.key==='d') moveRight=false;
});

// ====== Islands and water ======
function createIsland(x,z,w,h){
  let geo = new THREE.BoxGeometry(w,1,h);
  let mat = new THREE.MeshPhongMaterial({color:0x228B22});
  let island = new THREE.Mesh(geo, mat);
  island.position.set(x,0.5,z);
  scene.add(island);
}
createIsland(-10,-10,10,6);
createIsland(15,15,12,8);

let water = new THREE.Mesh(
  new THREE.BoxGeometry(100,0.5,100),
  new THREE.MeshPhongMaterial({color:0x1E90FF})
);
water.position.set(0,0.25,0);
scene.add(water);

// ====== Fishing ======
let rod = new THREE.Mesh(new THREE.BoxGeometry(0.1,0.1,2), new THREE.MeshBasicMaterial({color:0x8B4513}));
let rodLaunched=false, rodObj=null;
let isHolding=false, holdTime=0;
let fishing=false, clicks=0, fishObj=null;
let messageDiv=document.getElementById("message");

window.addEventListener('mousedown', ()=>{ isHolding=true; if(fishing) clicks++; });
window.addEventListener('mouseup', ()=>{
  if(isHolding && holdTime>=2 && !rodLaunched && !fishing) launchRod();
  isHolding=false; holdTime=0;
});

// Launch rod function
function launchRod(){
  rodLaunched=true;
  rodObj = rod.clone();
  rodObj.position.copy(camera.position).add(camera.getWorldDirection(new THREE.Vector3()).multiplyScalar(2));
  scene.add(rodObj);

  fishing=true;
  messageDiv.style.display='block';
  messageDiv.innerText="Waiting for Clownfish...";
  setTimeout(spawnFish,5000);
}

// Spawn fish
function spawnFish(){
  fishObj = new THREE.Mesh(new THREE.BoxGeometry(0.5,0.5,1), new THREE.MeshBasicMaterial({color:0xFF4500}));
  fishObj.position.copy(rodObj.position).add(new THREE.Vector3(0,0,-2));
  scene.add(fishObj);

  messageDiv.innerText="Clownfish caught! Click 10 times in 5 seconds!";
  clicks=0;
  let timer=0;
  let interval=setInterval(()=>{
    timer+=0.1;
    if(timer>=5){
      clearInterval(interval);
      if(clicks>=10) messageDiv.innerText="Clownfish successfully caught!";
      else messageDiv.innerText="Clownfish escaped!";
      setTimeout(()=>{
        messageDiv.style.display='none';
        fishing=false;
        rodLaunched=false;
        scene.remove(fishObj);
        scene.remove(rodObj);
      },2000);
    }
  },100);
}

// ====== Animation loop ======
let clock = new THREE.Clock();
function animate(){
  requestAnimationFrame(animate);

  let delta = clock.getDelta();
  let speed = 5 * delta;

  if(moveForward) player.position.add(player.getWorldDirection(new THREE.Vector3()).multiplyScalar(speed));
  if(moveBackward) player.position.add(player.getWorldDirection(new THREE.Vector3()).multiplyScalar(-speed));
  if(moveLeft){
    let dir = new THREE.Vector3();
    player.getWorldDirection(dir);
    dir.cross(camera.up);
    player.position.add(dir.multiplyScalar(-speed));
  }
  if(moveRight){
    let dir = new THREE.Vector3();
    player.getWorldDirection(dir);
    dir.cross(camera.up);
    player.position.add(dir.multiplyScalar(speed));
  }

  if(isHolding && !rodLaunched) holdTime += delta;

  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>
